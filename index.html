<html>
	<head>
		<title>Marcos Cobeña Morián</title>

		<link href="https://fonts.googleapis.com/css?family=Raleway:400,700,900" rel="stylesheet">

		<meta name="description" content="I write Software to solve people's problems" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		
		<style type="text/css">
			a {
				text-decoration-line: none;
				box-shadow: 0px 1px #333;
				color: #333;
			}

            #actualBody {
                line-height: 1.5em;
            }

            body {
                color: #333;
                font-family: 'Raleway', sans-serif;
                margin: 0px auto;
                max-width: 750px;
            }

            #bodyWrapper {
                height: inherit;
				margin: 0 16pt;
            }

            .center {
                text-align: center;
            }

            h1, h2, h3, h4, h5 {
                line-height: 1.25em;
				font-weight: 900;
            }

			#homeReturn {
				float: left;
			}

			img {
				width: 100%;
			}

			.right {
                text-align: right;
			}

            .signature {
				margin: 1.5em 0% 33.34%;
            }

			#title {
				margin-bottom: 0;
            }

            #titleWrapper {
				margin: 25% 0%;
            }
    	</style>
		
		<script src="scripts/jquery-3.1.1.min.js"></script>

		<script src="scripts/showdown.min.js"></script>
		
		<script type="text/javascript">
			var items = [];
			var posts = [];
			var converter = new showdown.Converter({ tables: true });
			var homeFilename = "home";
			var resourceNotFoundFilename = "404";
			var urlSeparator = "#/";

			$(document).on('click', 'a', function(event) {
				var href = $(this).attr("href");
				
				if (href.startsWith("http") || href.startsWith("mailto:") || !href.startsWith(urlSeparator)) {
					event.returnValue = false;
					return;
				}

				event.preventDefault();

				var filename = getJustFilename(href);
				pushState(filename);
				loadItem(filename);
			});

			$(window).on('popstate', function(event) {
				var state = event.originalEvent.state;

				if (state !== null) {
					loadItem(state.filename);
				} else {
					if (window.location.hash.length > 0) {
						// User manually enters a different path
						entryPoint();
					} else {
						// User taps back to root (i.e. https://marcoscobena.com)
						pushHomeStateAndLoadIt();
					}
				}
			});

			function addItem(title, filename, date) {
				var item = { title: title, filename: filename, date: date };
				items.push(item);
			}

			function addPost(title, filename, date) {
				var post = { title: title, filename: filename, date: date };
				posts.push(post);
			}

			function entryPoint() {
				var filename = getJustFilename(window.location.href);

				if (filename.length > 0) {
					loadItem(filename);
				} else {
					pushHomeStateAndLoadIt();
				}
			}

			function findItem(filename) {
				var item = items.find(function(item) {
					return item.filename == filename;
				});

				return item;
			}

			function getJustFilename(path) {
				var lastSlashIndex = path.lastIndexOf("/");
				var filename = path.substring(lastSlashIndex + 1);

				return filename;
			}

			function loadItem(filename) {
				var item = findItem(filename);

				if (item == undefined) {
					loadItem(resourceNotFoundFilename);
					return;
				}

                if (filename == "home") {
                    $("#homeReturn").fadeOut();
                } else {
                    $("#homeReturn").fadeIn();
                }
                
				var actualPath = "items/" + filename + ".md";

				$.get(actualPath, function (data) { 
					render(item, data); 
				});
			}

			function loadPost(filename) {
				var item = posts.find(function(post) {
					return post.filename == filename;
				});

				if (item == undefined) {
					loadItem(resourceNotFoundFilename);
					return;
				}

				pushState(filename);

				$("#homeReturn").fadeIn();

				var actualPath = "items/" + filename + ".md";

				$.get(actualPath, function (data) { 
					render(item, data); 
				});
			}

			function populatePosts()
			{
				$("#posts").empty();

				var help = "<option>Choose a post (day/month/year)...</option>";
				$("#posts").append(help);

				for (var i = 0; i < posts.length; i++) {
					var post = posts[i];
					var html = '<option value="' + post.filename + '">' +
						post.title + ' (' + post.date + ')' +
						'</option>';
					$("#posts").append(html);
				}
			}

			function pushHomeStateAndLoadIt() {
				pushState(homeFilename);
				loadItem(homeFilename);
			}

			function pushState(filename) {
				history.pushState({ filename: filename }, "", urlSeparator + filename);
			}

			function render(item, markDown) {
				document.title = item.title;

				$("#title").html(item.title);
				$("#date").html(item.date);
				$("#lastUpdate").fadeIn();

				var body = converter.makeHtml(markDown);
				$("#actualBody").html(body);

				if (item.filename == homeFilename) {
					$("#posts").change(function () {
						loadPost(this.value);
					});
					populatePosts();
				}

				window.scrollTo(0, 0);

				$("#lastUpdate")
					.delay(3000)
					.fadeOut();
			}
		</script>

		<script src="items/items.js"></script>
	</head>
	<body onload='entryPoint()'>
		<div id="bodyWrapper">
			<p id="homeReturn" class="center">
				<a href="#/home"><em>Sweet</em> home</a>
			</p>

			<div id="titleWrapper" class="right">
				<h1 id="title"></h1>
				<span id="lastUpdate">Updated: </span><span id="date"></span>
			</div>
			
			<div id="actualBody">
				<noscript>This site runs entirely in your browser, please double check JavaScript's enabled.</noscript>
			</div>

			<p class="signature">
				—<a href="mailto:marcoscm.digital@gmail.com">Marcos</a>
			</p>
		</div>
	</body>
</html>