<html>
	<head>
		<title>Marcos Cobeña Morián</title>

		<!--<meta name="viewport" content="width=device-width, initial-scale=1.0" />-->
		
		<link href="https://fonts.googleapis.com/css?family=EB+Garamond" rel="stylesheet">
		
		<style type="text/css">
			body {
				font-family: 'EB Garamond', serif;
                font-size: 16px;
				margin: 0px;
				min-width: 546px;
			}

			select {
				width: 100px;
			}

			.float-right {
				float: right; 
			}

			.hidden {
				display: none;
			}

			#home {
				border-radius: 273px; -moz-border-radius: 273px; -webkit-border-radius: 273px;
				background-color: white;
				display: table;
				margin: auto;
				position: absolute;
				top: 0; left: 0; bottom: 0; right: 0;
				width: 546px; height: 546px;
			}

			#home-inner {
				display: table-cell;
				line-height: 1.25em;
				padding: 80px;
				vertical-align: middle;
			}

			#home-outter {
				background-color: black;
				width: 100%; height: 100%;
			}
		</style>
		
		<script src="scripts/jquery-3.1.1.min.js"></script>

		<!-- Path.js provides path (yeah...) handling to make this behave like an actual web app -->
		<script src="scripts/path.min.js"></script>

		<script src="scripts/showdown.min.js"></script>
		
		<script type="text/javascript"> 
			var items = [];
			var converter = new showdown.Converter();
			var baseDocumentTitle = "";
			var selects = [];
					
			// addItem(
			// 	   title, <- Here goes the user-friendly title you want to show
			// 	   filename, <- Item's filename without .md extension, at the same level of this current one
			// 	   date <- Date, as is, i.e. will be rendered without conversion
			//     category <- Optional: predefined ones: "default", self-explanatory; "hidden", also self-explanatory
			// );
			function addItem(title, filename, date, category = "default") {
				var item = { title: title, filename: filename, date: date, category: category };

				items.push(item);

				Path.map("#/" + filename)
					.to(function () {
						if (filename == "home") {
							document.title = baseDocumentTitle;
							$("#article").hide();
							$("#home-outter").show();

							return;
						}

						$("#home-outter").hide();
						$("#article").show();

					    loadItem(filename);
					})
					.enter(populateItems);
			}

			function capitalizeFirstLetter(string) {
				return string.charAt(0).toUpperCase() + string.slice(1);
			}

			function entryPoint() {
				$.getJSON("items/items.json", function (data) {
					addItem("Home", "home", "22/10/1984", "hidden");

					$.each(data, function (key, val) {
						addItem(val.title, val.filename, val.date, val.category);
					});

					baseDocumentTitle = document.title;

					selects = $("select[id^=items]");
					selects.change(function () {
						window.location.href = window.location.origin + "/#/" + this.value;
					});
				
					// At least we need a "home" item to serve as the landing one
					Path.root("#/home");

					Path.rescue(function () {
						window.location.href = window.location.origin + "/#/404";
					});
						
					Path.listen();
				});
			}
			
			function loadItem(filename) {
				var actualPath = "items/" + filename + ".md";
			
				$.get(actualPath, function (data) {
					var item = items.find(function (item) { 
						return item.filename == filename;
					});

					document.title = item.title + ' - ' + baseDocumentTitle;
		
					$("#title").html(item.title);
			
    				var body = converter.makeHtml(data);

					$("#actualBody").html(body);

                    var signature = '-Marcos<br />Internet, ' + item.date;

                    $("#signature").html(signature);

					window.scrollTo(0, 0);
				});
			}

			function populateItems()
			{
				selects.each(function (index) {
					if (this.id == "items")
						populateSelectWithCategory("items", "default", "Articles");
					else
					{
						var category = this.id.substring("items-".length, this.id.length);
						var defaultOption = capitalizeFirstLetter(category);
						populateSelectWithCategory(this.id, category, defaultOption);
					}
				});
			}

			function populateSelectWithCategory(selectId, category, defaultOption)
			{
				var querySelectId = "#" + selectId;
				$(querySelectId).empty();
				$(querySelectId).append("<option>" + defaultOption + "</option>");
			
				for (var i = 0; i < items.length; i++) {
					var item = items[i];

					if (item.category == "hidden" || item.category != category)
						continue;
			
					var html = '<option value="' + item.filename + '">' + 
							item.title + ' - ' + item.date + 
						'</option>';
			
					$(querySelectId).append(html);
				}
			}
		</script>
	</head>
	<body onload='entryPoint()'>
		<div id="home-outter">
			<div id="home">
				<div id="home-inner">
					I love, since childhood, to build things which solve people's life;<br/>
					&emsp;Nowadays, materialized as Xamarin Mobile Engineer working at DevsDNA;<br/>
					<br/>
					<select id="items"></select> <a href="#/now">Now</a> &ndash;what I'm doing.<br/>
					<br/>
					<br/>
					De vez en cuando escribo sobre lo que descubro más importante en la vida:<br/>
					<br/>
					<select id="items-reflexiones"></select> <a href="mailto:hello@marcoscobena.com?subject=Suscribirme%20a%20Reflexiones">¡Suscríbete!</a><br/>
					<br/>
					<br/>
					<span class="float-right">&mdash;<a href="mailto:hello@marcoscobena.com">Marcos Cobeña Morián</a></span>
				</div>
			</div>
		</div>

		<div id="article" class="hidden">
			<div id="title" class="center">
			</div>
			
			<div id="actualBody">
			</div>

			<div id="signature">
			</div>

			<!-- <div class="center">
				<p>
					~
				</p>

				<select id="items">
				</select>
			</div>  -->
		</div>
	</body>
</html>